---
title: "Respons Analyse"
author: "Daniel Instebø"
date: "17 1 2020"
output: html_document
---

```{r Load Packages}
knitr::opts_chunk$set(echo = TRUE) 
rm(list = ls())                     # Slette allerede eksisterende data

if(!require(memisc)) { install.packages("memisc"); require(memisc)}  # 
if(!require(Hmisc)) { install.packages("Hmisc"); require(Hmisc)} 
if(!require(foreign)) { install.packages("foreign"); require(foreign)} 
if(!require(plyr)) { install.packages("plyr"); require(plyr)}
if(!require(tidyverse)) { install.packages("tidyverse"); require(tidyverse)}
if(!require(ggvis)) { install.packages("ggvis"); require(ggvis)}
if(!require(stargazer)) { install.packages("stargazer"); require(stargazer)}
if(!require(readxl)) { install.packages("readxl"); require(readxl)}
if(!require(xml2)) { install.packages("xml2"); require(xml2)}
if(!require(xlsx)) { install.packages("xlsx"); require(xlsx)}
if(!require(knitr)) { install.packages("knitr"); require(knitr)}
if(!require(scales)) { install.packages("scales"); require(scales)}
if(!require(haven)) { install.packages("haven"); require(haven)}
if(!require(lmtest)) { install.packages("lmtest"); require(lmtest)}
if(!require(rddtools)) { install.packages("rddtools"); require(rddtools)}
if(!require(dotwhisker)) { install.packages("dotwhisker"); require(dotwhisker)}
if(!require(sandwich)) { install.packages("sandwich"); require(sandwich)}

```

Laster inn data fra mappe med navnet "d":

```{r Laste inn data:}

d <- read_sav("responsanalyse.SAV") %>% mutate(gender = R1DEMOVATE21,
                                               postnr = R1DEMOVATE24,
                                               fodselsar = R1DEMOVATE22,
                                               jobb = R1DEMOVATE16,
                                               utdanning = R1DEMOVATE18,
                                               inntekt = R1DEMOVATE19,
                                               klasse = R1DEMOVATE15,
                                               vhakse = R1DEMOVATE12,
                                               parti = R1DEMOVATE13,
                                               svalg17 = R1DEMOVATE14,
                                               lvalg19 = R1DEMOVATE23) 

```

Datasettet har 900 observasjoner fordelt på 90 variabler. Alle er numeriske i SPSS-format med tilknyttede labels. Labels står oppført i den foreløpige dokumentasjonen fra Respons Analyse. Ideelt sett hadde jeg ønsket at dette var vektorer i klassen "character", men for enkel analyse har jeg gjort variablene om til faktorer.

For enkel analyse av hver variabel kan man bruke `head()` funksjonen. Da kommer både verdi og label opp.

```{r Skaffe oversikt over variabler}
d %>% glimpse()
```

Konverterer vektorer i SPSS-format:
```{r faktorisering}
variables_with_labels = map(d, function(x) attr(x, "class") == "haven_labelled") %>% unlist() %>%  names()
d_factored = d %>% mutate_at( vars(variables_with_labels), as_factor)
d_factored %>% glimpse()

d_factored$Bydel <- as.character((d_factored$Bydel))
d_factored$bydel_8 <- as.character((d_factored$bydel_8))
d_factored$R1DEMOVATE21 <- as.character((d_factored$R1DEMOVATE21))
d_factored$aldrkat <- as.character((d_factored$aldrkat))
d_factored$R1DEMOVATE16 <- as.character((d_factored$R1DEMOVATE16))
d_factored$R1DEMOVATE18 <- as.character((d_factored$R1DEMOVATE18))
d_factored$R1DEMOVATE19 <- as.character((d_factored$R1DEMOVATE19))
d_factored$R1DEMOVATE15 <- as.character((d_factored$R1DEMOVATE15))

d_factored$R1DEMOVATE1 <- as.character((d_factored$R1DEMOVATE1))
unique(d_factored$R1DEMOVATE1) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE1 <- str_remove(d_factored$R1DEMOVATE1, " - Jeg støtter det fullstendig")
d_factored$R1DEMOVATE1 <- str_remove(d_factored$R1DEMOVATE1, " - Jeg motsetter meg det fullstendig")
d_factored$R1DEMOVATE1 <- str_remove(d_factored$R1DEMOVATE1, " - Ikke sikker/Ubesvart")
unique(d_factored$R1DEMOVATE1)
d_factored$R1DEMOVATE1 <- as.numeric((d_factored$R1DEMOVATE1))
unique(d_factored$R1DEMOVATE1)

d_factored$R1DEMOVATE2 <- as.character((d_factored$R1DEMOVATE2))
unique(d_factored$R1DEMOVATE2) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE2 <- str_remove(d_factored$R1DEMOVATE2, " - Jeg støtter det fullstendig")
d_factored$R1DEMOVATE2 <- str_remove(d_factored$R1DEMOVATE2, " - Jeg motsetter meg det fullstendig")
d_factored$R1DEMOVATE2 <- str_remove(d_factored$R1DEMOVATE2, " - Ikke sikker/Ubesvart")
unique(d_factored$R1DEMOVATE2)
d_factored$R1DEMOVATE2 <- as.numeric((d_factored$R1DEMOVATE2))
unique(d_factored$R1DEMOVATE2)

d_factored$R1DEMOVATE3 <- as.character((d_factored$R1DEMOVATE3))
unique(d_factored$R1DEMOVATE3) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE3 <- str_remove(d_factored$R1DEMOVATE3, " - Jeg støtter det fullstendig")
d_factored$R1DEMOVATE3 <- str_remove(d_factored$R1DEMOVATE3, " - Jeg motsetter meg det fullstendig")
d_factored$R1DEMOVATE3 <- str_remove(d_factored$R1DEMOVATE3, " - Ikke sikker/Ubesvart")
unique(d_factored$R1DEMOVATE3)
d_factored$R1DEMOVATE3 <- as.numeric((d_factored$R1DEMOVATE3))
unique(d_factored$R1DEMOVATE3)

d_factored$R1DEMOVATE4 <- as.character((d_factored$R1DEMOVATE4))
unique(d_factored$R1DEMOVATE4) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE4 <- str_remove(d_factored$R1DEMOVATE4, " - Jeg støtter det fullstendig")
d_factored$R1DEMOVATE4 <- str_remove(d_factored$R1DEMOVATE4, " - Jeg motsetter meg det fullstendig")
d_factored$R1DEMOVATE4 <- str_remove(d_factored$R1DEMOVATE4, " - Ikke sikker/Ubesvart")
unique(d_factored$R1DEMOVATE4)
d_factored$R1DEMOVATE4 <- as.numeric((d_factored$R1DEMOVATE4))
unique(d_factored$R1DEMOVATE1)

d_factored$R1DEMOVATE5 <- as.character((d_factored$R1DEMOVATE5))
unique(d_factored$R1DEMOVATE5) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE5 <- str_remove(d_factored$R1DEMOVATE5, " - Jeg støtter det fullstendig")
d_factored$R1DEMOVATE5 <- str_remove(d_factored$R1DEMOVATE5, " - Jeg motsetter meg det fullstendig")
d_factored$R1DEMOVATE5 <- str_remove(d_factored$R1DEMOVATE5, " - Ikke sikker/Ubesvart")
unique(d_factored$R1DEMOVATE5)
d_factored$R1DEMOVATE5 <- as.numeric((d_factored$R1DEMOVATE5))
unique(d_factored$R1DEMOVATE5)

####
## 0 = Ingen tillit i det hele tatt, 10 = Full tillit
d_factored$R1DEMOVATE8 <- as.character((d_factored$R1DEMOVATE8))
unique(d_factored$R1DEMOVATE8) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE8 <- str_remove(d_factored$R1DEMOVATE8, " - Ingen tillit i det hele tatt")
d_factored$R1DEMOVATE8 <- str_remove(d_factored$R1DEMOVATE8, " - Full tillit")
d_factored$R1DEMOVATE8 <- str_replace(d_factored$R1DEMOVATE8, "Ikke sikker/ubesvart", "11")
unique(d_factored$R1DEMOVATE8)
d_factored$R1DEMOVATE8 <- as.numeric((d_factored$R1DEMOVATE8))
unique(d_factored$R1DEMOVATE8)

d_factored$R1DEMOVATE9 <- as.character((d_factored$R1DEMOVATE9))
unique(d_factored$R1DEMOVATE9) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE9 <- str_remove(d_factored$R1DEMOVATE9, " - Ingen tillit i det hele tatt")
d_factored$R1DEMOVATE9 <- str_remove(d_factored$R1DEMOVATE9, " - Full tillit")
d_factored$R1DEMOVATE9 <- str_replace(d_factored$R1DEMOVATE9, "Ikke sikker/ubesvart", "11")
unique(d_factored$R1DEMOVATE9)
d_factored$R1DEMOVATE9 <- as.numeric((d_factored$R1DEMOVATE9))
unique(d_factored$R1DEMOVATE9)

## 0 = Ikke i det hele tatt, 10 = Fullt og helt
d_factored$R1DEMOVATE10 <- as.character((d_factored$R1DEMOVATE10))
unique(d_factored$R1DEMOVATE10) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE10 <- str_remove(d_factored$R1DEMOVATE10, " - Ikke i det hele tatt")
d_factored$R1DEMOVATE10 <- str_remove(d_factored$R1DEMOVATE10, " - Fullt og helt")
d_factored$R1DEMOVATE10 <- str_replace(d_factored$R1DEMOVATE10, "Ikke sikker/ubesvart", "11")
unique(d_factored$R1DEMOVATE10)
d_factored$R1DEMOVATE10 <- as.numeric((d_factored$R1DEMOVATE10))
unique(d_factored$R1DEMOVATE10)

# 0 = Passer ikke i det hele tatt, 10 = Passer fullt og helt
d_factored$R1DEMOVATE11 <- as.character((d_factored$R1DEMOVATE11))
unique(d_factored$R1DEMOVATE11) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE11 <- str_remove(d_factored$R1DEMOVATE11, " - Passer fullt og helt")
d_factored$R1DEMOVATE11 <- str_remove(d_factored$R1DEMOVATE11, " - Passer ikke i det hele tatt")
d_factored$R1DEMOVATE11 <- str_replace(d_factored$R1DEMOVATE11, "Ikke sikker/ubesvart", "11")
unique(d_factored$R1DEMOVATE11)
d_factored$R1DEMOVATE11 <- as.numeric((d_factored$R1DEMOVATE11))
unique(d_factored$R1DEMOVATE11)

# Venstre høyre akse. 0 = Venstre, 10 = Høyre
d_factored$R1DEMOVATE12 <- as.character((d_factored$R1DEMOVATE12))
unique(d_factored$R1DEMOVATE12) # Husk at 11 nå er Ikke sikker/Ubesvart
d_factored$R1DEMOVATE12 <- str_remove(d_factored$R1DEMOVATE12, " - Venstre")
d_factored$R1DEMOVATE12 <- str_remove(d_factored$R1DEMOVATE12, " - Høyre")
d_factored$R1DEMOVATE12 <- str_replace(d_factored$R1DEMOVATE12, "Ikke sikker/Ubesvart", "11")
unique(d_factored$R1DEMOVATE12)
d_factored$R1DEMOVATE12 <- as.numeric((d_factored$R1DEMOVATE12))
unique(d_factored$R1DEMOVATE12)

# Hvilket parti stemte du på?
# Her må jeg endre på "Andre"-kolonnen.
d_factored$R1DEMOVATE13 <- as.character((d_factored$R1DEMOVATE13))
unique(d_factored$R1DEMOVATE13)
unique(d_factored$o_R1DEMOVATE13)
d_factored %>% group_by(R1DEMOVATE13) %>% count(R1DEMOVATE13)
d_factored %>% group_by(o_R1DEMOVATE13) %>% count(o_R1DEMOVATE13)
d_factored[d_factored$o_R1DEMOVATE13 == "BOMPENGE","R1DEMOVATE13"] <- "Folkeaksjonen Nei til mer bompenger (FNB)"
d_factored[d_factored$o_R1DEMOVATE13 == "BOMPENGEPARTIET","R1DEMOVATE13"] <- "Folkeaksjonen Nei til mer bompenger (FNB)"
d_factored[d_factored$o_R1DEMOVATE13 == "folkje askjon mot bompenger","R1DEMOVATE13"] <- "Folkeaksjonen Nei til mer bompenger (FNB)"
d_factored[d_factored$o_R1DEMOVATE13 == "De kristine'","R1DEMOVATE13"] <- "Partiet De Kristne"
d_factored %>% group_by(R1DEMOVATE13) %>% count(R1DEMOVATE13)
unique(d_factored$R1DEMOVATE13)

################

d_factored$R1DEMOVATE14 <- as.character((d_factored$R1DEMOVATE14))
unique(d_factored$R1DEMOVATE14) # Husk at 11 nå er Ikke sikker/Ubesvart
unique(d_factored$o_R1DEMOVATE14)
d_factored %>% group_by(R1DEMOVATE14) %>% count(R1DEMOVATE14)
d_factored %>% group_by(R1DEMOVATE14) %>% count(o_R1DEMOVATE14)
d_factored$o_R1DEMOVATE14 <- str_replace(d_factored$o_R1DEMOVATE14, "LIB", "Liberalistene")
unique(d_factored$R1DEMOVATE14)

d_factored$R1DEMOVATE23 <- as.character((d_factored$R1DEMOVATE23))
unique(d_factored$R1DEMOVATE23) # Husk at 11 nå er Ikke sikker/Ubesvart
unique(d_factored$o_R1DEMOVATE23)
d_factored %>% group_by(R1DEMOVATE23) %>% count(R1DEMOVATE23)
d_factored %>% group_by(o_R1DEMOVATE23) %>% count(o_R1DEMOVATE23)
d_factored[d_factored$o_R1DEMOVATE23 == "Bompengepartiet","R1DEMOVATE23"] <- "Folkeaksjonen Nei til mer bompenger (FNB)"
d_factored[d_factored$o_R1DEMOVATE23 == "bompengepartiet","R1DEMOVATE23"] <- "Folkeaksjonen Nei til mer bompenger (FNB)"
d_factored[d_factored$o_R1DEMOVATE23 == "fnb","R1DEMOVATE23"] <- "Folkeaksjonen Nei til mer bompenger (FNB)"
d_factored[d_factored$o_R1DEMOVATE23 == "bombpenge partiet","R1DEMOVATE23"] <- "Folkeaksjonen Nei til mer bompenger (FNB)"
d_factored %>% group_by(R1DEMOVATE23) %>% count(R1DEMOVATE23)
d_factored %>% group_by(o_R1DEMOVATE23) %>% count(o_R1DEMOVATE23)
unique(d_factored$R1DEMOVATE23)

#################
d_factored$gender <- as.character((d_factored$gender))
d_factored$jobb <- as.character((d_factored$jobb))
d_factored$utdanning <- as.character((d_factored$utdanning))
d_factored$inntekt <- as.character((d_factored$inntekt))
d_factored$klasse <- as.character((d_factored$klasse))
d_factored$parti <- as.character((d_factored$parti))
d_factored$svalg17 <- as.character((d_factored$svalg17))
d_factored$lvalg19 <- as.character((d_factored$lvalg19))
d_factored$vhakse <- d_factored$R1DEMOVATE12

##################
d_factored$R1DEMOVATE7_1 <- as.numeric(d_factored$R1DEMOVATE7_1)
d_factored$R1DEMOVATE7_2 <- as.numeric(d_factored$R1DEMOVATE7_2)
d_factored$R1DEMOVATE7_3 <- as.numeric(d_factored$R1DEMOVATE7_3)

d_factored %>% glimpse()
```

Tre av variablene kan man fylle inn svar selv ("Annet:"). Dette gjelder spørsmålene om partitilhørighet.
Dette består i hovedsak av feilkodinger av respondenter som sympatiserer med og/eller har stemt FNB, liberalistene eller De Kristne.. Dette har blitt omkodet manuelt.

```{r Partitilhørighet}
# unique(d_factored$o_R1DEMOVATE13) # <-- Dersom det var kommunevalg i morgen, hvilket ville du stemt på?
# unique(d_factored$o_R1DEMOVATE14) # <-- Hvilket parti stemte du på sist stortingsvalg?
# unique(d_factored$o_R1DEMOVATE23) # <-- Stemte du ved kommune- og fylkestingsvalget 2019?

```


Bakgrunnsvariablene våre er:
- ID:               IntervjuID
- Bosted:           kommnr, Bydel og bydel_8
- Alder:            alder og alderkat (og R1DEMOVATE22?)
- Subj. klasse:     R1DEMOVATE15
- Beskjeftigelse:   R1DEMOVATE16
- Utdannelse:       R1DEMOVATE18
- Inntekt:          R1DEMOVATE19
- Kjønn:            R1DEMOVATE21
- Postnummer:       R1DEMOVATE24

- V/H Akse:         R1DEMOVATE12
- Partitilhørighet: R1DEMOVATE13
- Stemt sist svalg: R1DEMOVATE14

Gjennomfører så grunnleggende dataanalyse:

```{r dataanalyse 1}
d_factored %>% group_by(kommnr) %>% count(kommnr) # Samtlige respondenter er fra Bergen

# Oversikt over respondenter fordelt på fire bydeler:
d_factored %>% group_by(Bydel) %>% count(Bydel) %>% ggplot(aes(x = fct_reorder(Bydel, n), y = n, fill = Bydel)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på fire bydeler", x = "Bydel", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

# Oversikt over respondenter fordelt på åtte bydeler:
d_factored %>% group_by(bydel_8) %>% count(bydel_8) %>% ggplot(aes(x = fct_reorder(bydel_8, n), y = n, fill = bydel_8)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på åtte bydeler", x = "Bydel", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

# Oversikt over alder:
d_factored %>% group_by(alder) %>% count(alder) %>% ggplot(aes(x = alder, y = n, fill = n)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på alder", x = "Alder", y = "Antall") + guides(fill = FALSE) + theme_bw()
d_factored %>% group_by(alder) %>% count(alder) %>% ggplot(aes(x = alder, y = n, fill = n)) + geom_point() + geom_line() + labs(title = "Antall respondenter", subtitle = "fordelt på alder", x = "Alder", y = "Antall") + guides(fill = FALSE) + theme_bw()

d_factored %>% group_by(alder) %>% count(alder) %>% arrange(desc(n)) %>% head(10) %>% ggplot(aes(x = alder, y = n, fill = n)) + geom_col() + theme_bw() + guides(fill = FALSE) + labs(title = "Antall respondenter", subtitle = "fordelt på alder", x = "Alder", y = "Antall")

# Oversikt over alder - kategori:
d_factored %>% group_by(aldrkat) %>% count(aldrkat) %>% ggplot(aes(x = aldrkat, y = n, fill = aldrkat)) + geom_col(binwidth = 1) + labs(title = "Antall respondenter", subtitle = "fordelt på alder", x = "Alder", y = "Antall") + guides(fill = FALSE) + theme_bw()

```

Vi har litt færre personer som er under 30 år sammenliknet med resten av utvalget. Tilsvarende flere blant de som er 60 år og eldre har svart på undersøkelsen. Dersom vi ikke grupperer respondentene i kategorier, så er det noe overrepresentasjon blant 27-åringer (n = 34), 28-åringer (n = 32) og 26-åringer (n = 26) - altså: Selv om yngre i litt mindre grad har svart på undersøkelsen, har vi høyest konsentrasjon rundt enkelte konkrete årskull. 

```{r dataanalyse 2}
# Kjønn
d_factored %>% group_by(gender) %>% count(gender) %>% ggplot(aes(x = fct_reorder(gender, n), y = n, fill = gender)) + geom_col() + scale_fill_manual(values = c("#0f4c75", "#c9b6e4")) + labs(title = "Antall respondenter", subtitle = "fordelt på kjønn", x = "Kjønn", y = "Antall") + guides(fill = FALSE) + theme_bw()

# Yrke:
d_factored %>% group_by(jobb) %>% count(jobb) %>% ggplot(aes(x = (fct_reorder(jobb, n)), y = n, fill = jobb)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på yrke", x = "Yrke", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

# Utdanning:
d_factored %>% group_by(utdanning) %>% count(utdanning) %>% ggplot(aes(x = utdanning, y = n, fill = utdanning)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på utdanning", x = "Utdanning", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

d_factored %>% group_by(utdanning) %>% count(utdanning)

# Inntekt
d_factored %>% group_by(inntekt) %>% count(inntekt) %>% ggplot(aes(x = inntekt, y = n, fill = inntekt)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på inntekt", x = "Inntekt", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

d_factored %>% group_by(inntekt) %>% count(inntekt)

# Subjektiv klasse:
d_factored %>% group_by(klasse) %>% count(klasse) %>% ggplot(aes(x = klasse, y = n, fill = klasse)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på subjektiv klasse", x = "Klasse", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

d_factored %>% group_by(klasse) %>% count(klasse) %>% ggplot(aes(x = (fct_reorder(klasse, n)), y = n, fill = klasse)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på subjektiv klasse", x = "Klasse", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

d_factored %>% group_by(klasse) %>% count(klasse) %>% arrange(desc(n))
```

Omtrent likt fordelt på kjønn - 458 menn og 442 kvinner. De fleste respondentene jobber i privat sektor (310), så kommer offentlig sektor (260). Overraskende (?) mange er trygdet eller pensjonist (223). Så følger studenter (60), selvstendig næringsdrivende (27), arbeidsledige (14) og ubesvart (6).

Selvrapportert utdanningsnivå er nærmest sjokkerende skjev; Grunnskole (31), Videregående (230), Universitet opp til 2 år (60), Universitet over 2 år (579).

Svært mange vil ikke oppgi inntekten sin og har desidert flest respondenter på dette spørsmålet (245). Ellers ser man en tendens mot normalfordeling, dog med en noe høy andel respondenter i kategorien 700 000 - 1 million.

De absolutt fleste rapporterer at de føler at de er i middelklassen. Så er det relativt jevnt mellom arbeiderklasse, lavere middelklasse og høyere middelklasse. Kun henholdsvis 10 og 9 respondenter rapporterer at de føler de er i underklasse eller overklasse. Kan henge sammen med at utvalget er skjevfordelt ihht utdanning?

```{r}
# Venstre-høyre-akse:
# 21 personer har ikke svart
d_factored %>% group_by(vhakse) %>% count(vhakse) %>% filter(vhakse != "Ikke sikker/Ubesvart") %>% ggplot(aes(x = vhakse, y = n, fill = vhakse)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på venstre/høyre-akse", x = "", y = "Antall") + guides(fill = FALSE) + theme_bw()

# Partitilhørighet (R1DEMOVATE13):
# Har i første figur filtrert ut alle alternativer for "Annet", "Vil ikke si", osv..
d_factored %>% group_by(parti) %>% count(parti) %>% filter(parti != "Vil ikke stemme /Vil stemme blankt" & parti != "Vil ikke si" & parti != "Andre" & parti != "Ikke sikker") %>% ggplot(aes(x = fct_reorder(parti, n), y = n, fill = parti)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på partitilhørighet", x = "", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

d_factored %>% group_by(parti) %>% count(parti) %>% ggplot(aes(x = parti, y = n, fill = parti)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på partitilhørighet", x = "", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

# Stemt ved stortingsvalget 2017:
d_factored %>% group_by(svalg17) %>% count(svalg17) %>% filter(svalg17 != "Ikke sikker/Ubesvart") %>% ggplot(aes(x = fct_reorder(svalg17, n), y = n, fill = svalg17)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på hva de stemte i Stortingsvalget 2017", x = "", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()

# Stemt ved Lokalvalget 2019:
d_factored %>% group_by(lvalg19) %>% count(lvalg19) %>% filter(lvalg19 != "Ikke sikker/Ubesvart") %>% ggplot(aes(x = fct_reorder(lvalg19, n), y = n, fill = lvalg19)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på hva de stemte i Lokal- og regionalvalget 2019", x = "", y = "Antall") + guides(fill = FALSE) + coord_flip() + theme_bw()
```

Utvalget er ideologisk ut fra venstre/høyre-aksen subjektivt normalfordelt, hvor de absolutt fleste er rundt "5" på en skala fra 1 / 10. Men det skurrer litt med partiene de utgir seg for å ha stemt på eller sympatiserer med. Her er Høyre klart i flertall. Men kanskje det at det er størst opplsutning rundt Høyre kan forklares av at det er relativt få selverklærte FrP-velgere i utvalget. Kampen om stemmene i midten eller litt til venstre for midten i Norge er det hard kamp om.

```{r}
# Hvordan er aldersfordelingen på partitilhørighet?
d_factored %>% group_by(parti) %>% 
  summarize(snitt = mean(alder),
            q25 = quantile(alder, 0.25),
            q75 = quantile(alder, 0.75)) %>% 
  arrange(desc(snitt)) %>% 
  ggplot(aes(x = fct_reorder(parti, snitt), y = snitt)) + 
  geom_point() + 
  geom_linerange(aes(ymin = q25, ymax = q75)) + 
  labs(title = "Snittalder", subtitle = "fordelt på partitilhørighet (med 25% og 75% kvantiler)", x = "", y = "Antall") +
  coord_flip() + 
  theme_bw() + 
  expand_limits(y = 15)

# Samme som over, uten "Annet"-kategoriene:
d_factored %>% group_by(parti) %>%
  filter(parti != "Vil ikke stemme /Vil stemme blankt" & parti != "Vil ikke si" & parti != "Andre" & parti != "Ikke sikker") %>%
  summarize(snitt = mean(alder),
            q25 = quantile(alder, 0.25),
            q75 = quantile(alder, 0.75)) %>% 
  arrange(desc(snitt)) %>% 
  ggplot(aes(x = fct_reorder(parti, snitt), y = snitt)) + 
  geom_point() + 
  geom_linerange(aes(ymin = q25, ymax = q75)) + 
  labs(title = "Snittalder", subtitle = "fordelt på partitilhørighet (med 25% og 75% kvantiler)", x = "", y = "Antall") +
  coord_flip() + 
  theme_bw() + 
  expand_limits(y = 15)

# Kjønnsfordeling på partitilhørighet:
d_factored %>% group_by(parti) %>% filter(parti != "Vil ikke stemme /Vil stemme blankt" & parti != "Vil ikke si" & parti != "Andre" & parti != "Ikke sikker") %>% ggplot(aes(x = parti, fill = gender)) + geom_bar(position = "dodge") + labs(title = "Antall respondenter", subtitle = "fordelt på partitilhørighet", x = "", y = "Antall") + coord_flip() + theme_bw() + scale_fill_manual(values = c("#0f4c75", "#c9b6e4"))   

```

# DATAANALYSE SURVEY OG EKSPERIMENTER:

```{r}
d_factored %>% glimpse()

d_factored %>% group_by(R1DEMOVATE1) %>% count(R1DEMOVATE1)     %>% filter(R1DEMOVATE1 != "11 - Ikke sikker/Ubesvart")
d_factored %>% group_by(R1DEMOVATE2) %>% count(R1DEMOVATE2)     %>% filter(R1DEMOVATE2 != "11 - Ikke sikker/Ubesvart")
d_factored %>% group_by(R1DEMOVATE3) %>% count(R1DEMOVATE3)     %>% filter(R1DEMOVATE3 != "11 - Ikke sikker/Ubesvart")
d_factored %>% group_by(R1DEMOVATE4) %>% count(R1DEMOVATE4)     %>% filter(R1DEMOVATE4 != "11 - Ikke sikker/Ubesvart")
d_factored %>% group_by(R1DEMOVATE5) %>% count(R1DEMOVATE5)     %>% filter(R1DEMOVATE5 != "11 - Ikke sikker/Ubesvart")
```

# Utforske eksperimenter:

## R1Demovate6:

```{r}
d_factored %>% glimpse()

d_factored %>% group_by(Alternativ)  %>% count(Alternativ)
d_factored %>% group_by(R1DEMOVATE6_Antall1)          %>% count(R1DEMOVATE6_Antall1)          %>% filter(!is.na(R1DEMOVATE6_Antall1))
d_factored %>% group_by(R1DEMOVATE6_Dag1)             %>% count(R1DEMOVATE6_Dag1)             %>% filter(!is.na(R1DEMOVATE6_Dag1))
d_factored %>% group_by(R1DEMOVATE6_Rekr1)            %>% count(R1DEMOVATE6_Rekr1)            %>% filter(!is.na(R1DEMOVATE6_Rekr1))
d_factored %>% group_by(R1DEMOVATE6_Komp1)            %>% count(R1DEMOVATE6_Komp1)            %>% filter(!is.na(R1DEMOVATE6_Komp1))
d_factored %>% group_by(R1DEMOVATE6_Sak1)             %>% count(R1DEMOVATE6_Sak1)             %>% filter(!is.na(R1DEMOVATE6_Sak1))
d_factored %>% group_by(R1DEMOVATE6_Grunnlag1)        %>% count(R1DEMOVATE6_Grunnlag1)        %>% filter(!is.na(R1DEMOVATE6_Grunnlag1))
d_factored %>% group_by(R1DEMOVATE6_Offentlig1)       %>% count(R1DEMOVATE6_Offentlig1)       %>% filter(!is.na(R1DEMOVATE6_Offentlig1))
d_factored %>% group_by(R1DEMOVATE6_1)                %>% count(R1DEMOVATE6_1)                %>% filter(!is.na(R1DEMOVATE6_1))

d_factored %>% group_by(R1DEMOVATE6_Antall2)          %>% count(R1DEMOVATE6_Antall2)          %>% filter(!is.na(R1DEMOVATE6_Antall2))
d_factored %>% group_by(R1DEMOVATE6_Dag2)             %>% count(R1DEMOVATE6_Dag2)             %>% filter(!is.na(R1DEMOVATE6_Dag2))
d_factored %>% group_by(R1DEMOVATE6_Rekr2)            %>% count(R1DEMOVATE6_Rekr2)            %>% filter(!is.na(R1DEMOVATE6_Rekr2))
d_factored %>% group_by(R1DEMOVATE6_Komp2)            %>% count(R1DEMOVATE6_Komp2)            %>% filter(!is.na(R1DEMOVATE6_Komp2))
d_factored %>% group_by(R1DEMOVATE6_Sak2)             %>% count(R1DEMOVATE6_Sak2)             %>% filter(!is.na(R1DEMOVATE6_Sak2))
d_factored %>% group_by(R1DEMOVATE6_Grunnlag2)        %>% count(R1DEMOVATE6_Grunnlag2)        %>% filter(!is.na(R1DEMOVATE6_Grunnlag2))
d_factored %>% group_by(R1DEMOVATE6_Offentlig2)       %>% count(R1DEMOVATE6_Offentlig2)       %>% filter(!is.na(R1DEMOVATE6_Offentlig2))
d_factored %>% group_by(R1DEMOVATE6_2)                %>% count(R1DEMOVATE6_2)                %>% filter(!is.na(R1DEMOVATE6_2))

d_factored %>% group_by(R1DEMOVATE6_Antall3)              %>% count(R1DEMOVATE6_Antall3)          %>% filter(!is.na(R1DEMOVATE6_Antall3))
d_factored %>% group_by(R1DEMOVATE6_Dag3)                 %>% count(R1DEMOVATE6_Dag3)             %>% filter(!is.na(R1DEMOVATE6_Dag3))
d_factored %>% group_by(R1DEMOVATE6_Rekr3)                %>% count(R1DEMOVATE6_Rekr3)            %>% filter(!is.na(R1DEMOVATE6_Rekr3))
d_factored %>% group_by(R1DEMOVATE6_Komp3)                %>% count(R1DEMOVATE6_Komp3)            %>% filter(!is.na(R1DEMOVATE6_Komp3))
d_factored %>% group_by(R1DEMOVATE6_Sak3)                 %>% count(R1DEMOVATE6_Sak3)             %>% filter(!is.na(R1DEMOVATE6_Sak3))
d_factored %>% group_by(R1DEMOVATE6_Grunnlag3)            %>% count(R1DEMOVATE6_Grunnlag3)        %>% filter(!is.na(R1DEMOVATE6_Grunnlag3))
d_factored %>% group_by(R1DEMOVATE6_Offentlig3)           %>% count(R1DEMOVATE6_Offentlig3)       %>% filter(!is.na(R1DEMOVATE6_Offentlig3))
d_factored %>% group_by(R1DEMOVATE6_3)                    %>% count(R1DEMOVATE6_3)                %>% filter(!is.na(R1DEMOVATE6_3))
```

## R1Demovate7:

```{r}
d_factored %>% glimpse()

d_factored %>% group_by(Alternativ)  %>% count(Alternativ)
d_factored %>% group_by(R1DEMOVATE7_Antall1)      %>%   count(R1DEMOVATE7_Antall1)        %>%   filter(!is.na(R1DEMOVATE7_Antall1))
d_factored %>% group_by(R1DEMOVATE7_Dag1)         %>%   count(R1DEMOVATE7_Dag1)           %>%   filter(!is.na(R1DEMOVATE7_Dag1))
d_factored %>% group_by(R1DEMOVATE7_Rekr1)        %>%   count(R1DEMOVATE7_Rekr1)          %>%   filter(!is.na(R1DEMOVATE7_Rekr1))
d_factored %>% group_by(R1DEMOVATE7_Komp1)        %>%   count(R1DEMOVATE7_Komp1)          %>%   filter(!is.na(R1DEMOVATE7_Komp1))
d_factored %>% group_by(R1DEMOVATE7_Sak1)         %>%   count(R1DEMOVATE7_Sak1)           %>%   filter(!is.na(R1DEMOVATE7_Sak1))
d_factored %>% group_by(R1DEMOVATE7_Grunnlag1)    %>%   count(R1DEMOVATE7_Grunnlag1)      %>%   filter(!is.na(R1DEMOVATE7_Grunnlag1))
d_factored %>% group_by(R1DEMOVATE7_Offentlig1)   %>%   count(R1DEMOVATE7_Offentlig1)     %>%   filter(!is.na(R1DEMOVATE7_Offentlig1))
d_factored %>% group_by(R1DEMOVATE7_1)            %>%   count(R1DEMOVATE7_1)              %>%   filter(!is.na(R1DEMOVATE7_1))

d_factored %>% group_by(R1DEMOVATE7_Antall2)      %>%   count(R1DEMOVATE7_Antall2)        %>%   filter(!is.na(R1DEMOVATE7_Antall2))
d_factored %>% group_by(R1DEMOVATE7_Dag2)         %>%   count(R1DEMOVATE7_Dag2)           %>%   filter(!is.na(R1DEMOVATE7_Dag2))
d_factored %>% group_by(R1DEMOVATE7_Rekr2)        %>%   count(R1DEMOVATE7_Rekr2)          %>%   filter(!is.na(R1DEMOVATE7_Rekr2))
d_factored %>% group_by(R1DEMOVATE7_Komp2)        %>%   count(R1DEMOVATE7_Komp2)          %>%   filter(!is.na(R1DEMOVATE7_Komp2))
d_factored %>% group_by(R1DEMOVATE7_Sak2)         %>%   count(R1DEMOVATE7_Sak2)           %>%   filter(!is.na(R1DEMOVATE7_Sak2))
d_factored %>% group_by(R1DEMOVATE7_Grunnlag2)    %>%   count(R1DEMOVATE7_Grunnlag2)      %>%   filter(!is.na(R1DEMOVATE7_Grunnlag2))
d_factored %>% group_by(R1DEMOVATE7_Offentlig2)   %>%   count(R1DEMOVATE7_Offentlig2)     %>%   filter(!is.na(R1DEMOVATE7_Offentlig2))
d_factored %>% group_by(R1DEMOVATE7_2)            %>%   count(R1DEMOVATE7_2)              %>%   filter(!is.na(R1DEMOVATE7_2))

d_factored %>% group_by(R1DEMOVATE7_Antall3)      %>%   count(R1DEMOVATE7_Antall3)        %>%   filter(!is.na(R1DEMOVATE7_Antall3))
d_factored %>% group_by(R1DEMOVATE7_Dag3)         %>%   count(R1DEMOVATE7_Dag3)           %>%   filter(!is.na(R1DEMOVATE7_Dag3))
d_factored %>% group_by(R1DEMOVATE7_Rekr3)        %>%   count(R1DEMOVATE7_Rekr3)          %>%   filter(!is.na(R1DEMOVATE7_Rekr3))
d_factored %>% group_by(R1DEMOVATE7_Komp3)        %>%   count(R1DEMOVATE7_Komp3)          %>%   filter(!is.na(R1DEMOVATE7_Komp3))
d_factored %>% group_by(R1DEMOVATE7_Sak3)         %>%   count(R1DEMOVATE7_Sak3)           %>%   filter(!is.na(R1DEMOVATE7_Sak3))
d_factored %>% group_by(R1DEMOVATE7_Grunnlag3)    %>%   count(R1DEMOVATE7_Grunnlag3)      %>%   filter(!is.na(R1DEMOVATE7_Grunnlag3))
d_factored %>% group_by(R1DEMOVATE7_Offentlig3)   %>%   count(R1DEMOVATE7_Offentlig3)     %>%   filter(!is.na(R1DEMOVATE7_Offentlig3))
d_factored %>% group_by(R1DEMOVATE7_3)            %>%   count(R1DEMOVATE7_3)              %>%   filter(!is.na(R1DEMOVATE7_3))
```

# R1Demovate8 - R1Demovate11

```{r}
d_factored %>%  group_by(R1DEMOVATE8)     %>% count(R1DEMOVATE8)      %>% filter(R1DEMOVATE8   != 11) # 11 = 6
#d_factored %>%  group_by(R1DEMOVATE89)    %>% count(R1DEMOVATE89)     %>% filter(R1DEMOVATE89  != 11) # 11 = 
d_factored %>%  group_by(R1DEMOVATE9)     %>% count(R1DEMOVATE9)      %>% filter(R1DEMOVATE9   != 11) # 11 = 9
d_factored %>%  group_by(R1DEMOVATE10)    %>% count(R1DEMOVATE10)     %>% filter(R1DEMOVATE10  != 11) # 11 = 26
d_factored %>%  group_by(R1DEMOVATE11)    %>% count(R1DEMOVATE11)     %>% filter(R1DEMOVATE11  != 11) # 11 = 8

d_factored %>% glimpse()

d_mod <- d_factored %>% filter(R1DEMOVATE1 != 11,
                      R1DEMOVATE2  != 11,
                      R1DEMOVATE3  != 11,
                      R1DEMOVATE4  != 11,
                      R1DEMOVATE5  != 11,
                      
                      R1DEMOVATE8  != 11,
                      R1DEMOVATE9  != 11,
                      R1DEMOVATE10 != 11,
                      R1DEMOVATE11 != 11,
                      R1DEMOVATE12 != 11) %>%
  
              filter( Alternativ   !=  2,
                     R1DEMOVATE6_1 != 999,
                     R1DEMOVATE6_2 != 999,
                     R1DEMOVATE6_3 != 999)
```

# Analyse:

## R1DEMOVATE6:

```{r}
#
d_factored$DEMOVATE6 <- NULL

# Models:
d_mod_1 <- lm(R1DEMOVATE6_1 ~ R1DEMOVATE6_Antall1 + R1DEMOVATE6_Dag1 + R1DEMOVATE6_Rekr1 + R1DEMOVATE6_Komp1 + R1DEMOVATE6_Sak1 + R1DEMOVATE6_Grunnlag1  + R1DEMOVATE6_Offentlig1, data = d_mod)
d_mod_2 <- lm(R1DEMOVATE6_2 ~ R1DEMOVATE6_Antall2 + R1DEMOVATE6_Dag2 + R1DEMOVATE6_Rekr2 + R1DEMOVATE6_Komp2 + R1DEMOVATE6_Sak2 + R1DEMOVATE6_Grunnlag2  + R1DEMOVATE6_Offentlig2, data = d_mod)
d_mod_3 <- lm(R1DEMOVATE6_3 ~ R1DEMOVATE6_Antall3 + R1DEMOVATE6_Dag3 + R1DEMOVATE6_Rekr3 + R1DEMOVATE6_Komp3 + R1DEMOVATE6_Sak3 + R1DEMOVATE6_Grunnlag3  + R1DEMOVATE6_Offentlig3, data = d_mod)

coef_1 <- coeftest(d_mod_1, vcov. = vcovCL(d_mod_1, factor(d_mod$IntervjuID)))
coef_2 <- coeftest(d_mod_2, vcov. = vcovCL(d_mod_2, factor(d_mod$IntervjuID)))
coef_3 <- coeftest(d_mod_3, vcov. = vcovCL(d_mod_3, factor(d_mod$IntervjuID)))

stars_1 <- symnum(coef_1[, ncol(coef_1)], corr = FALSE, na = FALSE, 
                cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1), 
                symbols = c("***", "**", "*", ".", " "))
stars_2 <- symnum(coef_2[, ncol(coef_2)], corr = FALSE, na = FALSE, 
                cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1), 
                symbols = c("***", "**", "*", ".", " "))
stars_3 <- symnum(coef_3[, ncol(coef_3)], corr = FALSE, na = FALSE, 
                cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1), 
                symbols = c("***", "**", "*", ".", " "))

out_1 <- cbind(as.data.frame.matrix(coef_1))
out_2 <- cbind(as.data.frame.matrix(coef_2))
out_3 <- cbind(as.data.frame.matrix(coef_3))

interval2 <- -qnorm((1-0.95)/2)  # 95% multiplier
interval2 <- qnorm((1-0.99)/2)  # 99% multiplier


## Lager dataframe av modellresultatene 
mod_1 <- data.frame(Variable_full = rownames(summary(d_mod_1)$coef),
                    Variable = c("Intercept", "Antall_100", "Antall_300", "Dag_Helgedag", "Rekruttering_Tilf-Utvalg", "Kompensasjon_200krt", "Kompensasjon_500krt", "Kompensasjon_1000krt", "Sak_Tiggeforbud", "Sak_Turistskatt", "Grunnlag_Uavh-Ekspert", "Grunnlag_Gruppediskusjon", "Offentlig_Nei"),
                    Coefficient = summary(d_mod_1)$coef[, 1],
                    SE = summary(d_mod_1)$coef[, 2],
                    Question = c("Intercept", "Antall", "Antall", "Dag", "Rekruttering", "Kompensasjon", "Kompensasjon", "Kompensasjon", "Sak", "Sak", "Grunnlag", "Grunnlag", "Offentliggjøring"),
                    Modell = "Modell 1",
                    Order = c(NA,2,3,5,7,9,10,11,13,14,16,17,19))

mod_2 <- data.frame(Variable_full = rownames(summary(d_mod_2)$coef),
                    Variable = c("Intercept", "Antall_100", "Antall_300", "Dag_Helgedag", "Rekruttering_Tilf-Utvalg", "Kompensasjon_200krt", "Kompensasjon_500krt", "Kompensasjon_1000krt", "Sak_Tiggeforbud", "Sak_Turistskatt", "Grunnlag_Uavh-Ekspert", "Grunnlag_Gruppediskusjon", "Offentlig_Nei"),
                    Coefficient = summary(d_mod_2)$coef[, 1],
                    SE = summary(d_mod_2)$coef[, 2],
                    Question = c("Intercept", "Antall", "Antall", "Dag", "Rekruttering", "Kompensasjon", "Kompensasjon", "Kompensasjon", "Sak", "Sak", "Grunnlag", "Grunnlag", "Offentliggjøring"),
                    Modell = "Modell 2",
                    Order = c(NA,2,3,5,7,9,10,11,13,14,16,17,19))

mod_3 <- data.frame(Variable_full = rownames(summary(d_mod_3)$coef),
                    Variable = c("Intercept", "Antall_100", "Antall_300", "Dag_Helgedag", "Rekruttering_Tilf-Utvalg", "Kompensasjon_200krt", "Kompensasjon_500krt", "Kompensasjon_1000krt", "Sak_Tiggeforbud", "Sak_Turistskatt", "Grunnlag_Uavh-Ekspert", "Grunnlag_Gruppediskusjon", "Offentlig_Nei"),
                    Coefficient = summary(d_mod_3)$coef[, 1],
                    SE = summary(d_mod_3)$coef[, 2],
                    Question = c("Intercept", "Antall", "Antall", "Dag", "Rekruttering", "Kompensasjon", "Kompensasjon", "Kompensasjon", "Sak", "Sak", "Grunnlag", "Grunnlag", "Offentliggjøring"),
                    Modell = "Modell 3",
                    Order = c(NA,2,3,5,7,9,10,11,13,14,16,17,19))

#mod_1$Variable_full <- NULL
#mod_2$Variable_full <- NULL
#mod_3$Variable_full <- NULL

rownames(mod_1) <- NULL
rownames(mod_2) <- NULL
rownames(mod_3) <- NULL

# Add baseline:
mod_1 <- mod_1 %>% 
    add_row("Variable_full" = "R1DEMOVATE6_Antall112", "Variable" = "Antall_12", "Coefficient" = 0, "SE" = 0, "Question" = "Antall", "Modell" = "Modell 1", "Order" = 1, .before = 2) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Dag1Hverdag", "Variable" = "Dag_Hverdag", "Coefficient" = 0, "SE" = 0, "Question" = "Dag", "Modell" = "Modell 1", "Order" = 4, .before = 5) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Rekr1RegistreringOpenForAlle", "Variable" = "Rekruttering_Open", "Coefficient" = 0, "SE" = 0, "Question" = "Rekruttering", "Modell" = "Modell 1",  "Order" = 6, .before = 7) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Komp1IngenKomp", "Variable" = "Kompensasjon_Ingen", "Coefficient" = 0, "SE" = 0, "Question" = "Kompensasjon", "Modell" = "Modell 1",  "Order" = 8, .before = 9) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Sak1BoligbyggingStoreLungegaards", "Variable" = "Sak_Boligbygging", "Coefficient" = 0, "SE" = 0, "Question" = "Sak", "Modell" = "Modell 1",  "Order" = 12, .before = 13) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Grunnlag1EgneVurderinger", "Variable" = "Grunnlag_Egne", "Coefficient" = 0, "SE" = 0, "Question" = "Grunnlag", "Modell" = "Modell 1",  "Order" = 15,    .before = 16) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Offentlig1Offentlig", "Variable" = "Offentlig_Ja", "Coefficient" = 0, "SE" = 0, "Question" = "Offentliggjøring", "Modell" = "Modell 1",  "Order" = 18,  .before = 19) %>%
    filter(Variable_full != "(Intercept)") 

mod_2 <- mod_2 %>% 
    add_row("Variable_full" = "R1DEMOVATE6_Antall212", "Variable" = "Antall_12", "Coefficient" = 0, "SE" = 0, "Question" = "Antall", "Modell" = "Modell 2", "Order" = 1, .before = 2) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Dag2Hverdag", "Variable" = "Dag_Hverdag", "Coefficient" = 0, "SE" = 0, "Question" = "Dag", "Modell" = "Modell 2", "Order" = 4, .before = 5) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Rekr2RegistreringOpenForAlle", "Variable" = "Rekruttering_Open", "Coefficient" = 0, "SE" = 0, "Question" = "Rekruttering", "Modell" = "Modell 2",  "Order" = 6, .before = 7) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Komp2IngenKomp", "Variable" = "Kompensasjon_Ingen", "Coefficient" = 0, "SE" = 0, "Question" = "Kompensasjon", "Modell" = "Modell 2",  "Order" = 8, .before = 9) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Sak2BoligbyggingStoreLungegaards", "Variable" = "Sak_Boligbygging", "Coefficient" = 0, "SE" = 0, "Question" = "Sak", "Modell" = "Modell 2",  "Order" = 12, .before = 13) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Grunnlag2EgneVurderinger", "Variable" = "Grunnlag_Egne", "Coefficient" = 0, "SE" = 0, "Question" = "Grunnlag", "Modell" = "Modell 2",  "Order" = 15,    .before = 16) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Offentlig2Offentlig", "Variable" = "Offentlig_Ja", "Coefficient" = 0, "SE" = 0, "Question" = "Offentliggjøring", "Modell" = "Modell 2",  "Order" = 18,  .before = 19) %>%
    filter(Variable_full != "(Intercept)") 

mod_3 <- mod_3 %>% 
    add_row("Variable_full" = "R1DEMOVATE6_Antall312", "Variable" = "Antall_12", "Coefficient" = 0, "SE" = 0, "Question" = "Antall", "Modell" = "Modell 3", "Order" = 1, .before = 2) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Dag3Hverdag", "Variable" = "Dag_Hverdag", "Coefficient" = 0, "SE" = 0, "Question" = "Dag", "Modell" = "Modell 3", "Order" = 4, .before = 5) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Rekr3RegistreringOpenForAlle", "Variable" = "Rekruttering_Open", "Coefficient" = 0, "SE" = 0, "Question" = "Rekruttering", "Modell" = "Modell 3",  "Order" = 6, .before = 7) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Komp3IngenKomp", "Variable" = "Kompensasjon_Ingen", "Coefficient" = 0, "SE" = 0, "Question" = "Kompensasjon", "Modell" = "Modell 3",  "Order" = 8, .before = 9) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Sak3BoligbyggingStoreLungegaards", "Variable" = "Sak_Boligbygging", "Coefficient" = 0, "SE" = 0, "Question" = "Sak", "Modell" = "Modell 3",  "Order" = 12, .before = 13) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Grunnlag3EgneVurderinger", "Variable" = "Grunnlag_Egne", "Coefficient" = 0, "SE" = 0, "Question" = "Grunnlag", "Modell" = "Modell 3",  "Order" = 15,    .before = 16) %>%
    add_row("Variable_full" = "R1DEMOVATE6_Offentlig3Offentlig", "Variable" = "Offentlig_Ja", "Coefficient" = 0, "SE" = 0, "Question" = "Offentliggjøring", "Modell" = "Modell 3",  "Order" = 18,  .before = 19) %>%
    filter(Variable_full != "(Intercept)") 


modfr <- data.frame(rbind(mod_1, mod_2, mod_3))
modfr %>% glimpse()

modfr$Variable <- as.character(modfr$Variable)


zp1 <- ggplot(modfr, aes(color = Modell))
zp1 <- zp1 + geom_hline(yintercept = 0, colour = gray(1/2), lty = 2) 
zp1 <- zp1 + geom_linerange(aes(x = reorder(Variable, -Order), ymin = Coefficient - SE*interval2,
                            ymax = Coefficient + SE*interval2),
                            lwd = 1, position = position_dodge(width = 1/2))

zp1 <- zp1 + geom_pointrange(aes(x = Variable, y = Coefficient, ymin = Coefficient - SE*interval2,
                             ymax = Coefficient + SE*interval2),
                             lwd = 1/2, position = position_dodge(width = 1/2),
                             shape = 21, fill = "WHITE") + 
                             ylab("Sannsynlighet for oppmøte") + 
                             xlab("Attributt") 

zp1 <- zp1 + scale_x_discrete(labels=rev(c("12 deltakere",
                                           "100 deltakere", 
                                           "300 deltakere", 
                                           "Hverdag", 
                                           "Helgedag", 
                                           "Åpen påmelding", 
                                           "Tilfeldig utvalg", 
                                           "Ingen kompensasjon", 
                                           "200 kr/t", 
                                           "500 kr/t", 
                                           "1000 kr/t", 
                                           "Boligbygging på Store Lungegårdsvann", 
                                           "Tiggeforbud", 
                                           "Turistskatt", 
                                           "Egne vurderinger",
                                           "Uavhengige eksperter",
                                           "Gruppediskusjon",
                                           "Ja",
                                           "Nei"
                                           )))

zp1 <- zp1 + scale_x_discrete(labels=rev(c("Antall: 12",
                                           "Antall: 100", 
                                           "Antall: 300", 
                                           "Dag: Hverdag", 
                                           "Dag: Helgedag", 
                                           "Rekruttering: Åpen påmelding", 
                                           "Rekruttering: Tilfeldig utvalg", 
                                           "Kompensasjon: Ingen kompensasjon", 
                                           "Kompensasjon: 200 kr/t", 
                                           "Kompensasjon: 500 kr/t", 
                                           "Kompensasjon: 1000 kr/t", 
                                           "Sak: Boligbygging på Store Lungegårdsvann", 
                                           "Sak: Tiggeforbud", 
                                           "Sak: Turistskatt", 
                                           "Grunnlag: Egne vurderinger",
                                           "Grunnlag: Uavhengige eksperter",
                                           "Grunnlag: Gruppediskusjon",
                                           "Offentliggjøring: Ja",
                                           "Offentliggjøring: Nei"
                                           )))

zp1 <- zp1 + theme_bw() + coord_flip() + ggtitle("R1DEMOVATE6:\n    Effekt av attributter på sannsynlighet for oppmøte (m/95% konfidensintervall)")
plot(zp1)


rm(zp1)                    

```

```{r}
d_mod_2 <- lm(R1DEMOVATE6_2 ~ R1DEMOVATE6_Antall2 + R1DEMOVATE6_Dag2 + R1DEMOVATE6_Rekr2 + R1DEMOVATE6_Komp2 + R1DEMOVATE6_Sak2 + R1DEMOVATE6_Grunnlag2  + R1DEMOVATE6_Offentlig2, data = d_mod)
coef <- coeftest(d_mod_2, vcov. = vcovCL(d_mod_2, factor(d_mod$IntervjuID)))

stars <- symnum(coef[, ncol(coef)], corr = FALSE, na = FALSE, 
                cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1), 
                symbols = c("***", "**", "*", ".", " "))

out <- cbind(as.data.frame.matrix(coef))
modfr <- out

interval2 <- -qnorm((1-0.95)/2)  # 95% multiplier
interval2 <- qnorm((1-0.99)/2)  # 99% multiplier


## Lager dataframe av modellresultatene 
modfr <- data.frame(Variable = rownames(summary(d_mod_2)$coef),
                    Coefficient = summary(d_mod_2)$coef[, 1],
                    SE = summary(d_mod_2)$coef[, 2],
                    modelName = "Attributes")

zp1 <- ggplot(modfr, aes(color = Variable))
zp1 <- zp1 + geom_hline(yintercept = 0, colour = gray(1/2), lty = 2) 
zp1 <- zp1 + geom_linerange(aes(x = Variable, ymin = Coefficient - SE*interval2,
                            ymax = Coefficient + SE*interval2),
                            lwd = 1, position = position_dodge(width = 1/2)) 

zp1 <- zp1 + geom_pointrange(aes(x = Variable, y = Coefficient, ymin = Coefficient - SE*interval2,
                             ymax = Coefficient + SE*interval2),
                             lwd = 1/2, position = position_dodge(width = 1/2),
                             shape = 21, fill = "WHITE") + ylab("Sannsynlighet for oppmøte") +                                                     xlab("Attributt") + scale_x_discrete(labels=rev(c("Sak: Turistskatt",
                                                                  "Sak: Tiggeforbud",
                                                                  "Rekruttering: Tilfeldig",
                                                                  "Offentlig: Nei",
                                                                  "Kompensasjon: 500 kr/t",
                                                                  "Kompensasjon: 200 kr/t",
                                                                  "Kompensasjon: 1000 kr/t",
                                                                  "Grunnlag: Troverdig info fra eksperter",
                                                                  "Grunnlag: Mindre grupper, ledet av uavh. mod",
                                                                  "Dag: Helgedag",
                                                                  "Inviterte: 1300",
                                                                  "Inviterte: 1100",
                                                                  "Intercept")))

zp1 <- zp1 + theme_grey() + coord_flip()  + guides(color = FALSE)           
zp1 <- zp1 + ggtitle("R1DEMOVATE6_2: \n Effekt av attributter på sannsynlighet for oppmøte (m/95% konfidensintervall")

print(zp1)

```

```{r}
d_mod_3 <- lm(R1DEMOVATE6_3 ~ R1DEMOVATE6_Antall3 + R1DEMOVATE6_Dag3 + R1DEMOVATE6_Rekr3 + R1DEMOVATE6_Komp3 + R1DEMOVATE6_Sak3 + R1DEMOVATE6_Grunnlag3  + R1DEMOVATE6_Offentlig3, data = d_mod)
coef <- coeftest(d_mod_3, vcov. = vcovCL(d_mod_3, factor(d_mod$IntervjuID)))

stars <- symnum(coef[, ncol(coef)], corr = FALSE, na = FALSE, 
                cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1), 
                symbols = c("***", "**", "*", ".", " "))

out <- cbind(as.data.frame.matrix(coef))
modfr <- out

interval2 <- -qnorm((1-0.95)/2)  # 95% multiplier
interval2 <- qnorm((1-0.99)/2)  # 99% multiplier


## Lager dataframe av modellresultatene 
modfr <- data.frame(Variable = rownames(summary(d_mod_3)$coef),
                    Coefficient = summary(d_mod_3)$coef[, 1],
                    SE = summary(d_mod_3)$coef[, 2],
                    modelName = "Attributes")

zp1 <- ggplot(modfr, aes(color = Variable))
zp1 <- zp1 + geom_hline(yintercept = 0, colour = gray(1/2), lty = 2) 
zp1 <- zp1 + geom_linerange(aes(x = Variable, ymin = Coefficient - SE*interval2,
                            ymax = Coefficient + SE*interval2),
                            lwd = 1, position = position_dodge(width = 1/2)) 

zp1 <- zp1 + geom_pointrange(aes(x = Variable, y = Coefficient, ymin = Coefficient - SE*interval2,
                             ymax = Coefficient + SE*interval2),
                             lwd = 1/2, position = position_dodge(width = 1/2),
                             shape = 21, fill = "WHITE") + ylab("Sannsynlighet for oppmøte") +                                                     xlab("Attributt") + scale_x_discrete(labels=rev(c("Sak: Turistskatt",
                                                                  "Sak: Tiggeforbud",
                                                                  "Rekruttering: Tilfeldig",
                                                                  "Offentlig: Nei",
                                                                  "Kompensasjon: 500 kr/t",
                                                                  "Kompensasjon: 200 kr/t",
                                                                  "Kompensasjon: 1000 kr/t",
                                                                  "Grunnlag: Troverdig info fra eksperter",
                                                                  "Grunnlag: Mindre grupper, ledet av uavh. mod",
                                                                  "Dag: Helgedag",
                                                                  "Inviterte: 1300",
                                                                  "Inviterte: 1100",
                                                                  "Intercept")))

zp1 <- zp1 + theme_grey() + coord_flip()  + guides(color = FALSE)           
zp1 <- zp1 + ggtitle("R1DEMOVATE6_3: \n Effekt av attributter på sannsynlighet for oppmøte (m/95% konfidensintervall")

print(zp1)
```

<!-- ```{r} -->
<!-- d_mod_4 <- lm(R1DEMOVATE7_1 ~ R1DEMOVATE7_Antall1 + R1DEMOVATE7_Dag1 + R1DEMOVATE7_Rekr1 + R1DEMOVATE7_Komp1 + R1DEMOVATE7_Sak1 + R1DEMOVATE7_Grunnlag1  + R1DEMOVATE7_Offentlig1, data = d_mod) -->
<!-- coef <- coeftest(d_mod_4, vcov. = vcovCL(d_mod_4, factor(d_mod$IntervjuID))) -->

<!-- stars <- symnum(coef[, ncol(coef)], corr = FALSE, na = FALSE,  -->
<!--                 cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1),  -->
<!--                 symbols = c("***", "**", "*", ".", " ")) -->

<!-- out <- cbind(as.data.frame.matrix(coef)) -->
<!-- modfr <- out -->

<!-- interval2 <- -qnorm((1-0.95)/2)  # 95% multiplier -->
<!-- interval2 <- qnorm((1-0.99)/2)  # 99% multiplier -->


<!-- ## Lager dataframe av modellresultatene  -->
<!-- modfr <- data.frame(Variable = rownames(summary(d_mod_3)$coef), -->
<!--                     Coefficient = summary(d_mod_3)$coef[, 1], -->
<!--                     SE = summary(d_mod_3)$coef[, 2], -->
<!--                     modelName = "Attributes") -->

<!-- zp1 <- ggplot(modfr, aes(color = Variable)) -->
<!-- zp1 <- zp1 + geom_hline(yintercept = 0, colour = gray(1/2), lty = 2)  -->
<!-- zp1 <- zp1 + geom_linerange(aes(x = Variable, ymin = Coefficient - SE*interval2, -->
<!--                             ymax = Coefficient + SE*interval2), -->
<!--                             lwd = 1, position = position_dodge(width = 1/2))  -->

<!-- zp1 <- zp1 + geom_pointrange(aes(x = Variable, y = Coefficient, ymin = Coefficient - SE*interval2, -->
<!--                              ymax = Coefficient + SE*interval2), -->
<!--                              lwd = 1/2, position = position_dodge(width = 1/2), -->
<!--                              shape = 21, fill = "WHITE") + ylab("Sannsynlighet for oppmøte") +                                                     xlab("Attributt") + scale_x_discrete(labels=rev(c("Sak: Turistskatt", -->
<!--                                                                   "Sak: Tiggeforbud", -->
<!--                                                                   "Rekruttering: Tilfeldig", -->
<!--                                                                   "Offentlig: Nei", -->
<!--                                                                   "Kompensasjon: 500 kr/t", -->
<!--                                                                   "Kompensasjon: 200 kr/t", -->
<!--                                                                   "Kompensasjon: 1000 kr/t", -->
<!--                                                                   "Grunnlag: Troverdig info fra eksperter", -->
<!--                                                                   "Grunnlag: Mindre grupper, ledet av uavh. mod", -->
<!--                                                                   "Dag: Helgedag", -->
<!--                                                                   "Inviterte: 1300", -->
<!--                                                                   "Inviterte: 1100", -->
<!--                                                                   "Intercept"))) -->

<!-- zp1 <- zp1 + theme_grey() + coord_flip()  + guides(color = FALSE)            -->
<!-- zp1 <- zp1 + ggtitle("R1DEMOVATE6_3: \n Effekt av attributter på sannsynlighet for oppmøte (m/95% konfidensintervall") -->

<!-- print(zp1) -->
<!-- ``` -->



<!-- ```{r} -->
<!-- d_factored %>% glimpse() -->

<!-- d_factored %>% group_by(R1DEMOVATE1) %>% count(R1DEMOVATE1) %>% filter(R1DEMOVATE1 != "11 - Ikke sikker/Ubesvart") %>% ggplot(aes(x = vhakse, y = n, fill = vhakse)) + geom_col() + labs(title = "Antall respondenter", subtitle = "fordelt på venstre/høyre-akse", x = "", y = "Antall") + guides(fill = FALSE) + theme_bw() -->
<!-- ``` -->




